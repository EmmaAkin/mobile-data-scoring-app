<div class="wrapper-grey">
  <div class="header-banner">
    <div class="header-title">
        <h1>Your Personal Details</h1>
    </div>
    <div class="round-icon">
      <i><span class="fa fa-id-card"></span></i>
    </div>
  </div>
  <div class="container white-box">
    <div class="row profile-card">
      <div class="col-6-xs profile-picture">
        <!-- If you want a profile picture: Could take from facebook profile -->
      </div>
      <div class="profile-info container-centered">
        <h2><%= @user.gender == 'male' ? 'Mr' : 'Mrs' %><%= ' ' + @user.first_name.capitalize if @user.first_name.present? %> <%= ' ' + @user.last_name.capitalize  if @user.last_name.present? %></h2>
        <h3>Your mobile number:<br> <%= @user.mobile_number %></h3>
        <p>DoB: <%= @user.date_of_birth.strftime('%e %b %Y') if @user.date_of_birth.present? %></p>
        <p><%= @user.email if @user.email.present? %></p>
        <p><%= @user.address if @user.address.present? %></p>
        <p><%= @user.city if @user.city.present? %> <%= ', ' + @user.postcode if @user.postcode.present? %></p>
        <%= link_to edit_user_path(@user) do %>
          <button class="btn-royal-blue"><%= 'EDIT YOUR DETAILS' %></button>
          <p class="text-red"><%= 'Details incomplete. It is important that all of your details are correct.' unless @user.details_completed? %></p>
        <% end %>
      </div>
    </div>

    <% if @user.loans.present? && (@user.loans.last.status == "Application Pending" || "Application Accepted" || "Loan Outstanding" || "Application Declined") %>
      <%= link_to user_status_path(@user) do %>
        <div class="current-loan">
          <h5>Current Loan Status:</h5>
          <% case @user.loans.last.status %>
            <% when "Application Pending" %>
              <%= "Pending" %>
            <% when "Application Accepted" %>
              <%= "Accepted! Click here to confirm." %>
            <% when "Loan Outstanding" %>
              <%= "Ongoing" %>
            <% when "Application Declined" %>
              <%= "Declined" %>
          <% end %>
        </div>
      <% end %>
    <% else %>
      <br>
    <% end %>

    <div class="loan-history">
      <h5>Loan History</h5>
      <p><%= "You haven't previously taken out any loans." if @user.loans == [] %></p>

    <% if @user.loans.present? %>


      <div class="standard-flexbox">
        <div class="flexrow text-center">
          <div class="flexcell third-cell blue-header">
            <p>Date</p>
          </div>
          <div class="flexcell third-cell blue-header">
            <p>Amount</p>
          </div>
          <div class="flexcell third-cell blue-header">
            <p>Duration</p>
          </div>
        </div>

        <% @user.loans.each do |loan| %>
          <div class="flexrow text-center">
            <% case loan.status %>
              <% when "Application Pending" %>
                <div class="flexcell third-cell">
                  <%= loan.final_date %>
                </div>
                <div class="flexcell third-cell">
                  <%= loan.agreed_amount_cents %>
                </div>
                <div class="flexcell third-cell">
                  <%= "Pending" %>
                </div>
              <% when "Application Accepted" %>
                <div class="flexcell third-cell">
                  <%= loan.final_date %>
                </div>
                <div class="flexcell third-cell">
                  <%= loan.agreed_amount_cents %>
                </div>
                <div class="flexcell third-cell">
                  <%= "Accepted" %>
                </div>
              <% when "Loan Outstanding" %>
                <div class="flexcell third-cell">
                  <%= loan.final_date %>
                </div>
                <div class="flexcell third-cell">
                  <%= loan.agreed_amount_cents %>
                </div>
                <div class="flexcell third-cell">
                  <%= "Ongoing" %>
                </div>
              <% when "Application Declined" %>
                <div class="flexcell third-cell">
                  <%= loan.application_date %>
                </div>
                <div class="flexcell third-cell">
                  <%= loan.requested_amount_cents %>
                </div>
                <div class="flexcell third-cell">
                  <%= "Declined" %>
                </div>
              <% when "Loan Repaid" %>
                <div class="flexcell third-cell">
                  <%= loan.final_date %>
                </div>
                <div class="flexcell third-cell">
                  <%= loan.agreed_amount_cents %>
                </div>
                <div class="flexcell third-cell">
                  <%= "Repaid" %>
                </div>
            <% end %>
          </div>
        <% end %>
      </div>
      <% end %>
    </div>
  </div>
</div>
